import pandas as pd

# Example: load your dataframe
# df = pd.read_csv("sgh_c_spend_summary.csv")  

result = (
    df.groupby("snapshot_date")
      .agg(
          SPEND=("SPENDS", "sum"),
          debit_active=("SPEND_ACTIVE_TOTAL", lambda x: x.sum() / len(x))
      )
      .reset_index()
      .sort_values("snapshot_date")
)

print(result.head())


# First get the aggregated result
result = (
    df.groupby("snapshot_date")
      .agg(
          SPEND=("SPENDS", "sum"),
          debit_active=("SPEND_ACTIVE_TOTAL", lambda x: x.sum() / len(x))
      )
      .reset_index()
      .sort_values("snapshot_date")
)

# Melt + Pivot to transpose
pivot_df = result.melt(id_vars=["snapshot_date"], 
                       var_name="Metric", 
                       value_name="Value")

final = pivot_df.pivot_table(
    index="Metric",
    columns="snapshot_date",
    values="Value"
).reset_index()

print(final)




bt

import pandas as pd

# Example: df = pd.read_csv("sgh_c_installment_tracker.csv")

# Aggregate
result = (
    df.groupby("month")
      .agg(
          BT_PORTFOLIO_BAL=(
              "installment_balance", 
              lambda x: x[df.loc[x.index, "plan_type"].isin(["BT", "BTI"])].sum()
          )
      )
      .reset_index()
      .sort_values("month")
)

# Transpose (months as columns, metric as row)
pivot_df = result.melt(
    id_vars=["month"], 
    var_name="Metric", 
    value_name="Value"
)

final = pivot_df.pivot_table(
    index="Metric",
    columns="month",
    values="Value"
).reset_index()

print(final)