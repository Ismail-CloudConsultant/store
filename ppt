import os
from selenium import webdriver
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By
from selenium.common.exceptions import (
    NoSuchElementException, ElementNotVisibleException,
    ElementNotSelectableException, StaleElementReferenceException
)

def load_browser(chrome_app, gcxi_url, base_path):
    chromepath = "{}".format(chrome_app)
    chrome_options = webdriver.ChromeOptions()

    # Setup download directory
    download_path = os.path.join(base_path, 'Download')
    download_path_pref = {"download.default_directory": rf"{download_path}"}

    chrome_options.add_experimental_option("prefs", download_path_pref)
    chrome_options.add_experimental_option('useAutomationExtension', False)
    chrome_options.binary_location = chromepath

    # âœ… No need to specify chromedriver.exe manually (Selenium Manager handles it)
    browser = webdriver.Chrome(options=chrome_options)
    browser.get(gcxi_url)

    wait = WebDriverWait(
        browser,
        600,
        poll_frequency=1,
        ignored_exceptions=[
            NoSuchElementException, ElementNotVisibleException,
            ElementNotSelectableException, StaleElementReferenceException
        ]
    )

    wait.until(EC.element_to_be_clickable((By.ID, '3054')))
    browser.maximize_window()

    return browser, wait