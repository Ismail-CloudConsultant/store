import pandas as pd

# Assume df is your original DataFrame
df = df_raw.copy()

# Step 1: Strip whitespaces from 'Country' and 'Metric'
df['Country'] = df['Country'].str.strip()
df['Metric'] = df['Metric'].str.strip()

# Step 2: Create 'COUNTRY' based on mapping logic
country_map = {
    "UK (adjusted ex JLFS)": "UK",
    "AMH": "AMH",
    "HASE": "HASE",
    "HASE HK": "HASE",
    "Mexico": "MEX",
    "UAE": "UAE",
    "Singapore": "SGH",
    "Malaysia": "MYH",
    "India": "INM",
    "Vietnam": "VNM",
    "Taiwan": "TWN",
    "Indonesia": "IMO",
    "Philippines": "MNL",
    "Australia": "AUH",
    "Egypt": "EGY",
    "US (adjusted)": "USA",
    "US": "USA",
    "China": "AOC",
    "Canada (adjusted)": "CAN",
    "Focus market margins ex JLFS, US, China, CA": "GlobalExclUSAOCCANJLFS",
    "Focus market margins ex. JLFS, CA": "GlobalExJLFSCA",
    "Global ex Fr": "IWPB"
}

# Apply mapping with fallback to original
df['COUNTRY'] = df['Country'].map(country_map).fillna(df['Country'])

# Step 3: Add 'country_metric' as Country || Metric
df['country_metric'] = df['Country'] + df['Metric']

# Step 4: Drop original 'Country' column (equivalent to SELECT * EXCEPT(Country))
df = df.drop(columns=['Country'])