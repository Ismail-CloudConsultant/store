import pandas as pd
import numpy as np

# Trim columns
df['Country_CDE'] = df['Country_cde'].str.strip()
df['ASSET'] = df['ASSET'].astype(str).str.strip()
df['Data_Upload_TS'] = pd.to_datetime(df['Data_Upload_TS'], errors='coerce')

# Define country map for first SELECT
country_map_main = {
    'GBP': 'UK',
    'HKD': 'AMH',
    'MXN': 'MEX',
    'AED': 'UAE',
    'SGD': 'SGH',
    'MYR': 'MYH',
    'INR': 'INM',
    'VND': 'VNM',
    'TWD': 'TWN',
    'AUD': 'AUH',
    'EGP': 'EGY',
    'CAD': 'CAN',
    'USD': 'USA',
    'CNY': 'AOC',
    'IDR': 'IMO',
    'PHP': 'MNL'
}

# Define country map for second SELECT (HKD → HASE)
country_map_hase = {
    'HKD': 'HASE'
}

# Filter for main query
main_countries = list(country_map_main.keys())
df_main = df[df['Country_CDE'].isin(main_countries)].copy()
df_main['COUNTRY'] = df_main['Country_CDE'].map(country_map_main)
df_main['FX'] = pd.to_numeric(df_main['ASSET'], errors='coerce')
df_main['Date'] = df_main['Data_Upload_TS'] + pd.offsets.MonthEnd(0)

# Filter for second part (just HKD → HASE)
df_hase = df[df['Country_CDE'] == 'HKD'].copy()
df_hase['COUNTRY'] = df_hase['Country_CDE'].map(country_map_hase)
df_hase['FX'] = pd.to_numeric(df_hase['ASSET'], errors='coerce')
df_hase['Date'] = df_hase['Data_Upload_TS'] + pd.offsets.MonthEnd(0)

# Select final columns
df_main = df_main[['Country_CDE', 'FX', 'Date', 'COUNTRY']]
df_hase = df_hase[['Country_CDE', 'FX', 'Date', 'COUNTRY']]

# Union All
final_df = pd.concat([df_main, df_hase], ignore_index=True)